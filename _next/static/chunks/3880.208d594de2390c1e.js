"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3880],{3880:function(e,t,n){n.r(t),n.d(t,{go:function(){return v}});var r=n(8520),a=n.n(r),s=n(737),o=n(5503),c=n(5762),i=n(4642),u=n(7702),p=(0,o.ZF)({apiKey:"AIzaSyC2K76ycMyLhAYOd_XOa3aC3Cnqe6dEno0",authDomain:"showdownspace.firebaseapp.com",databaseURL:"https://showdownspace-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"showdownspace",storageBucket:"showdownspace.appspot.com",messagingSenderId:"999073329546",appId:"1:999073329546:web:08df5e95a021605ca49873",measurementId:"G-9LV3C4S19C"}),l=((0,c.IH)(p),(0,i.N8)(p),(0,u.v0)(p)),h=new Promise((function(e){(0,u.Aj)(l,(function(t){e()}))}));function d(e,t,n,r,a,s,o){try{var c=e[s](o),i=c.value}catch(u){return void n(u)}c.done?t(i):Promise.resolve(i).then(r,a)}function f(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var s=e.apply(t,n);function o(e){d(s,r,a,o,c,"next",e)}function c(e){d(s,r,a,o,c,"throw",e)}o(void 0)}))}}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){m(e,t,n[t])}))}return e}function v(){return w.apply(this,arguments)}function w(){return(w=f(a().mark((function e(){var t,n,r,o,c,p,d,m,v,w,k,g,x,S,O,C,I,_,N,P,U,j,E,T,D;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h;case 2:if(!(t=window.location.hash.match(/auth_token=([^&]+)/))){e.next=8;break}return n=t[1],e.next=7,(0,u._p)(l,n);case 7:window.location.replace(window.location.hash.replace(/auth_token=[^&]+/,"_=_"));case 8:if(l.currentUser){e.next=11;break}return s.h.state={state:"error",message:"You are not authenticated",details:"Changes will not be saved. Please access Code in the Wind Editor from the link provided to you in Discord."},e.abrupt("return");case 11:return r=l.currentUser,e.next=14,r.getIdTokenResult();case 14:return o=e.sent,c=o.claims.name,s.h.state={state:"idle",message:"[".concat(c,"] Authenticated")},p=(0,i.iH)((0,i.N8)()),d=(0,i.iU)(p,"rooms/citw"),m=(0,i.iU)(d,"publicSubmissions/".concat(r.uid)),e.next=22,(0,i.U2)(m);case 22:function z(){return A.apply(this,arguments)}function A(){return(A=f(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,i.iU)(d,"presence/".concat(r.uid)),e.next=4,(0,i.t8)(t,(0,i.Bt)());case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Unable to save presence info",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function B(){return H.apply(this,arguments)}function H(){return(H=f(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=(0,i.iU)(d,"profiles/".concat(r.uid)),e.next=4,(0,i.t8)(t,{name:c});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),console.error("Unable to save profile info",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}v=e.sent,w="meow",k={},v.exists()?(g=v.child("data").val(),k=JSON.parse(g),s.h.state=b({},s.h.state,{state:"idle",message:"[".concat(c,"] Content restored (size=").concat(g.length,")"),overrideInitialContent:b({},k.html?{html:k.html}:{},k.css?{css:k.css}:{},k.compiledCss?{compiledCss:k.compiledCss}:{}),synchronizeToken:w})):s.h.state=b({},s.h.state,{synchronizeToken:w}),z(),B(),setInterval((function(){return z()}),1e4);case 33:if(e.prev=33,(x=b({},k,s.if)).html&&x.css){e.next=38;break}return console.log("Not saving empty data"),e.abrupt("continue",75);case 38:for(S=Object.keys(s.if),O=0,C=!0,I=!1,_=void 0,e.prev=41,N=S[Symbol.iterator]();!(C=(P=N.next()).done);C=!0)U=P.value,k[U]!==s.if[U]&&(k[U]=s.if[U],O++),delete s.if[U];e.next=49;break;case 45:e.prev=45,e.t0=e.catch(41),I=!0,_=e.t0;case 49:e.prev=49,e.prev=50,C||null==N.return||N.return();case 52:if(e.prev=52,!I){e.next=55;break}throw _;case 55:return e.finish(52);case 56:return e.finish(49);case 57:if(!(O>0)){e.next=65;break}return j=JSON.stringify(k),e.next=61,(0,i.t8)(m,{data:j,submittedAt:(0,i.Bt)()});case 61:E=new Date,T=function(e){return e<10?"0"+e:e},D=E.getHours()+":"+T(E.getMinutes())+":"+T(E.getSeconds()),s.h.state=b({},s.h.state,{state:"idle",message:"[".concat(c,"] Saved at ").concat(D," (size=").concat(j.length,")")});case 65:e.next=71;break;case 67:e.prev=67,e.t1=e.catch(33),console.error(e.t1),s.h.state=b({},s.h.state,{state:"error",message:"[".concat(c,"] Sync error"),details:String(e.t1)+y(String(e.t1))+"\n\nYour submission has NOT been saved. To avoid losing your work, please make a backup copy of your code and then reload the page."});case 71:return e.prev=71,e.next=74,new Promise((function(e){return setTimeout(e,3e3)}));case 74:return e.finish(71);case 75:e.next=33;break;case 77:case"end":return e.stop()}}),e,null,[[33,67,71,75],[41,45,49,57],[50,,52,56]])})))).apply(this,arguments)}function y(e){return e.match(/PERMISSION_DENIED/)?"\n\nThis is most likely because the editor has been locked because either the time is up or the game hasn\u2019t been started yet.":""}}}]);